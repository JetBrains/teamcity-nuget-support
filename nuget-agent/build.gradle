plugins {
    id 'com.github.rodm.teamcity-agent' version '1.1.1'
}

teamcity {
    version = teamcityVersion

    agent {
        descriptor = project.file('teamcity-agent-plugin.xml')

        files {
            into('bin') {
                from (project(':nuget-extensions').file('bin')) {
                    include '**/*JetBrains*'
                    include '**/*TeamCity*'
                    include '**/*Newtonsoft*.dll'
                    include '**/*PowerArgs*.dll'
                    include '**/NuGet.*.dll'
                    include '**/credential-plugin/**/*'
                    exclude '**/*.deps.json'
                    exclude '**/*.dev.json'
                }
            }
        }
    }
}

dependencies {
    compile project(':nuget-common')
    compile "org.jetbrains.kotlin:kotlin-stdlib"
    provided "org.jetbrains.teamcity.internal:agent:$teamcityVersion"
    provided files("${teamcityDir}/buildAgent/lib/common-impl.jar")
    provided files("${teamcityDir}/webapps/ROOT/WEB-INF/lib/nuget-utils.jar")
}

agentPlugin.version = null
agentPlugin.baseName = 'nuget-agent'

tasks.withType(JavaCompile) {
    sourceCompatibility = "1.6"
    targetCompatibility = "1.6"
}

compileKotlin {
    sourceCompatibility = JavaVersion.VERSION_1_6
    targetCompatibility = JavaVersion.VERSION_1_6
}
