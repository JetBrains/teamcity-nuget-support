plugins {
    id 'com.github.rodm.teamcity-server' version '1.3.2'
}

teamcity {
    version = teamcityVersion
}

ext {
    olingoVersion = '2.0.10'
}

dependencies {
    implementation project(':nuget-common')
    implementation project(':nuget-agent')
    implementation project(':nuget-feed')
    implementation project(':nuget-server')
    implementation project(':nuget-server-common')

    implementation "org.apache.olingo:olingo-odata2-api-annotation:$olingoVersion"
    implementation 'org.core4j:core4j:0.5'
    implementation 'org.odata4j:odata4j-core:0.8.0-SNAPSHOT'
    implementation 'org.odata4j:odata4j-jersey:0.8.0-SNAPSHOT'
    implementation 'commons-codec:commons-codec:1.10'
    implementation 'com.sun.jersey:jersey-client:1.11'
    implementation 'com.sun.jersey:jersey-core:1.11'
    implementation 'com.sun.jersey:jersey-server:1.11'
    implementation 'com.sun.jersey:jersey-servlet:1.11'
    implementation "org.apache.olingo:olingo-odata2-api:$olingoVersion"
    implementation "org.apache.olingo:olingo-odata2-api-annotation:$olingoVersion"
    implementation "org.apache.olingo:olingo-odata2-core:$olingoVersion"
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
    implementation "joda-time:joda-time:2.5"  

    provided files("${teamcityDir}/webapps/ROOT/WEB-INF/lib/nuget-utils.jar")
    provided files("${teamcityDir}/webapps/ROOT/WEB-INF/lib/common-impl.jar")
    provided files("${teamcityDir}/webapps/ROOT/WEB-INF/lib/server-tools.jar")
    provided "org.jetbrains.teamcity.internal:server:$teamcityVersion"
    provided "org.jetbrains.teamcity.internal:agent:$teamcityVersion"
    provided "org.jetbrains.teamcity:agent-api:$teamcityVersion"
    provided 'javax.ws.rs:javax.ws.rs-api:2.0'
    provided "org.apache.commons:commons-lang3:3.12.0"
    provided 'org.hamcrest:hamcrest-all:1.1'
    provided 'org.testng:testng:6.8'
    provided 'org.jmock:jmock:2.5.1'
    provided 'org.jmock:jmock-legacy:2.5.1'
    provided "org.jetbrains.teamcity:tests-support:$teamcityVersion"   
    provided 'org.apache.httpcomponents:httpcore:4.4.3'
    provided 'commons-fileupload:commons-fileupload:1.3'  
    provided files("${teamcityDir}/devPackage/tests/tests-integration.jar")
    provided files("${teamcityDir}/webapps/ROOT/WEB-INF/lib/web.jar")
    provided files("${teamcityDir}/webapps/ROOT/WEB-INF/lib/db.jar")
    provided files("${teamcityDir}/buildAgent/lib/server-logging.jar")
    provided "org.jetbrains.teamcity.internal:server:$teamcityVersion"
    provided "org.jetbrains.teamcity:agent-api:$teamcityVersion"
    provided "com.github.ben-manes.caffeine:caffeine:2.4.0"
}

sourceSets {
    main {
        java {
            srcDirs = []
        }
    }

    test {
        java {
            srcDirs = ['src']
        }

        resources {
            srcDirs = ['testData']
        }
    }
}

tasks.withType(Test) {
    scanForTestClasses = false
}

test {
    useTestNG() {
        suites 'src/testng-nuget-fast.xml'
    }
}

task integrationTest(type: Test) {
	useTestNG() {
 		suites 'src/testng-nuget-integration.xml'
	}
}

task performanceTest(type: Test) {
	useTestNG() {
 		suites 'src/testng-nuget-performance.xml'
	}
}
